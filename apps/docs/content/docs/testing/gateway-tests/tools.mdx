---
title: Tools Tests
description: 2 tests for function calling capabilities
---

# Tools Tests

Tools tests verify that models can call functions (tools) when appropriate, returning structured tool call requests.

## Test Summary

| Test | Model | Description |
|------|-------|-------------|
| Claude Tools | claude-sonnet-4.5 | Weather function call |
| GPT-4o Tools | gpt-4o | Weather function call |

## Running Tests

```bash
cd packages/@layers/models
AI_GATEWAY_API_KEY=vck_xxx bun test gateway -t "tools"
```

## Test Implementation

### Tool Definition

```typescript
const weatherTool = {
  type: 'function' as const,
  function: {
    name: 'get_weather',
    description: 'Get the current weather in a location',
    parameters: {
      type: 'object',
      properties: {
        location: {
          type: 'string',
          description: 'The city and state, e.g. San Francisco, CA',
        },
        unit: {
          type: 'string',
          enum: ['celsius', 'fahrenheit'],
          description: 'Temperature unit',
        },
      },
      required: ['location'],
    },
  },
};
```

### Claude Tools Test

```typescript
it('should call tools with Claude', async () => {
  const result = await generateText({
    model: gateway('anthropic/claude-sonnet-4.5'),
    messages: [
      {
        role: 'user',
        content: 'What is the weather in San Francisco?',
      },
    ],
    tools: [weatherTool],
    toolChoice: 'auto',
    maxTokens: 100,
  });

  expect(result.toolCalls).toBeDefined();
  expect(result.toolCalls.length).toBeGreaterThan(0);
  expect(result.toolCalls[0].toolName).toBe('get_weather');
  expect(result.toolCalls[0].args.location).toContain('San Francisco');
});
```

### GPT-4o Tools Test

```typescript
it('should call tools with GPT-4o', async () => {
  const result = await generateText({
    model: gateway('openai/gpt-4o'),
    messages: [
      {
        role: 'user',
        content: 'What is the weather in San Francisco?',
      },
    ],
    tools: [weatherTool],
    toolChoice: 'auto',
    maxTokens: 100,
  });

  expect(result.toolCalls).toBeDefined();
  expect(result.toolCalls.length).toBeGreaterThan(0);
  expect(result.toolCalls[0].toolName).toBe('get_weather');
});
```

## Tool Call Response

When a model decides to call a tool, the response includes:

```typescript
{
  text: '',  // Usually empty when calling tools
  toolCalls: [
    {
      toolCallId: 'call_abc123',
      toolName: 'get_weather',
      args: {
        location: 'San Francisco, CA',
        unit: 'fahrenheit'
      }
    }
  ]
}
```

## Tool Choice Options

| Option | Description |
|--------|-------------|
| `'auto'` | Model decides whether to call tools |
| `'none'` | Never call tools, only generate text |
| `'required'` | Must call at least one tool |
| `{ type: 'function', function: { name: 'get_weather' } }` | Force specific tool |

## Supported Models

| Model | Tools Support |
|-------|---------------|
| anthropic/claude-* | Yes |
| openai/gpt-4o | Yes |
| openai/gpt-4o-mini | Yes |
| google/gemini-* | Yes |
| perplexity/sonar | No |
| morph/morph-* | No |

## Multi-Tool Calls

Models can call multiple tools in one response:

```typescript
const result = await generateText({
  model: gateway('anthropic/claude-sonnet-4.5'),
  messages: [
    {
      role: 'user',
      content: 'What is the weather in San Francisco and New York?',
    },
  ],
  tools: [weatherTool],
  maxTokens: 200,
});

// May return multiple tool calls
expect(result.toolCalls.length).toBe(2);
```
