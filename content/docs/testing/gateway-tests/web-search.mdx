---
title: Web Search Tests
description: 1 test for Perplexity web search capabilities
---

# Web Search Tests

Web search tests verify that Perplexity models can search the web and return responses with citations.

## Test Summary

| Test | Model | Description |
|------|-------|-------------|
| Perplexity Search | sonar | Web search with citations |

## Running Tests

```bash
cd packages/@layers/models
AI_GATEWAY_API_KEY=vck_xxx bun test gateway -t "search"
```

## Test Implementation

### Perplexity Web Search Test

```typescript
it('should perform web search with Perplexity', async () => {
  const { text } = await generateText({
    model: gateway('perplexity/sonar'),
    messages: [
      {
        role: 'user',
        content: 'What is the current weather in San Francisco?',
      },
    ],
    maxTokens: 200,
  });

  expect(text).toBeTruthy();
  // Response should contain weather-related information
  expect(text.toLowerCase()).toMatch(/weather|temperature|degrees|forecast/);
});
```

## How Web Search Works

Perplexity models automatically search the web when queries require current information:

```typescript
import { generateText } from 'ai';

const { text } = await generateText({
  model: gateway('perplexity/sonar'),
  prompt: 'What are the latest developments in AI?',
});

// Response includes current information with citations
console.log(text);
```

## Supported Models

| Model | Web Search | Notes |
|-------|------------|-------|
| perplexity/sonar | Yes | Default search model |
| perplexity/sonar-pro | Yes | Enhanced search capabilities |
| anthropic/claude-* | No | No web access |
| openai/gpt-* | No | No web access |
| google/gemini-* | No | No web access |

## Response Format

Perplexity responses typically include:
- Answer text with inline citations
- Source URLs (in some configurations)
- Confidence indicators

```typescript
const { text } = await generateText({
  model: gateway('perplexity/sonar'),
  prompt: 'Who won the 2024 Super Bowl?',
});

// Response includes citations like [1], [2], etc.
console.log(text);
// "The Kansas City Chiefs won Super Bowl LVIII [1]..."
```

## Use Cases

### Current Events

```typescript
const { text } = await generateText({
  model: gateway('perplexity/sonar'),
  prompt: 'What are the top news stories today?',
});
```

### Research Queries

```typescript
const { text } = await generateText({
  model: gateway('perplexity/sonar'),
  prompt: 'What are the latest research findings on quantum computing?',
});
```

### Fact Checking

```typescript
const { text } = await generateText({
  model: gateway('perplexity/sonar'),
  prompt: 'Is it true that [claim]? Provide sources.',
});
```

## Limitations

1. **Rate limits** - Perplexity has stricter rate limits than other providers
2. **Response time** - Web search adds latency (2-5 seconds typical)
3. **No streaming citations** - Citations only available in final response
4. **Region-specific** - Some results may vary by region

## Best Practices

1. **Use for current information** - News, weather, recent events
2. **Expect longer response times** - Web search adds latency
3. **Handle rate limits** - Implement retry logic
4. **Verify citations** - Cross-reference important claims

## Comparison: Search vs Non-Search Models

| Aspect | Perplexity (Search) | Claude/GPT (No Search) |
|--------|---------------------|------------------------|
| Current events | Yes | No (knowledge cutoff) |
| Response time | Slower | Faster |
| Citations | Yes | No |
| Rate limits | Stricter | More generous |
| Cost | Variable | Predictable |

## Error Handling

```typescript
try {
  const { text } = await generateText({
    model: gateway('perplexity/sonar'),
    prompt: 'Current stock price of AAPL?',
  });
  console.log(text);
} catch (error) {
  if (error.message.includes('rate limit')) {
    // Wait and retry
    await new Promise(resolve => setTimeout(resolve, 5000));
  } else {
    console.error('Search failed:', error);
  }
}
```
