---
title: Thinking Tests (API)
description: 3 tests for extended reasoning via the Layers API
---

# Thinking Tests (API)

Thinking tests verify that the Layers API correctly handles extended thinking (chain-of-thought) requests for Claude models.

## Test Summary

| Test | Model | Description |
|------|-------|-------------|
| Basic Thinking | claude-sonnet-4.5 | Extended reasoning enabled |
| Thinking Budget | claude-sonnet-4.5 | Respect token budget |
| Thinking Content | claude-sonnet-4.5 | Return thinking blocks |

## Running Tests

```bash
cd packages/@layers/models
LAYERS_API_URL=https://layers.hustletogether.com \
LAYERS_API_KEY=lyr_live_xxx \
bun test layers-api -t "Thinking"
```

## Test Implementation

### Basic Thinking Test

```typescript
it('should enable thinking with Claude via API', async () => {
  const response = await fetch(`${LAYERS_API_URL}/api/v1/chat`, {
    method: 'POST',
    headers: {
      'Authorization': `Bearer ${LAYERS_API_KEY}`,
      'Content-Type': 'application/json',
    },
    body: JSON.stringify({
      model: 'anthropic/claude-sonnet-4.5',
      messages: [
        {
          role: 'user',
          content: 'What is 15 * 23? Think through it step by step.',
        },
      ],
      anthropic: {
        thinking: {
          type: 'enabled',
          budget_tokens: 5000,
        },
      },
      max_tokens: 1000,
    }),
  });

  expect(response.status).toBe(200);
  const data = await response.json();

  expect(data.choices[0].message.content).toBeTruthy();
  expect(data.choices[0].message.content).toContain('345');
});
```

### Thinking Budget Test

```typescript
it('should respect thinking budget', async () => {
  const response = await fetch(`${LAYERS_API_URL}/api/v1/chat`, {
    method: 'POST',
    headers: {
      'Authorization': `Bearer ${LAYERS_API_KEY}`,
      'Content-Type': 'application/json',
    },
    body: JSON.stringify({
      model: 'anthropic/claude-sonnet-4.5',
      messages: [
        { role: 'user', content: 'Explain why the sky is blue briefly.' }
      ],
      anthropic: {
        thinking: {
          type: 'enabled',
          budget_tokens: 1000,
        },
      },
      max_tokens: 500,
    }),
  });

  expect(response.status).toBe(200);
  const data = await response.json();

  // Token usage should be reasonable
  expect(data.usage.total_tokens).toBeLessThan(2000);
});
```

### Thinking Content Test

```typescript
it('should return thinking blocks', async () => {
  const response = await fetch(`${LAYERS_API_URL}/api/v1/chat`, {
    method: 'POST',
    headers: {
      'Authorization': `Bearer ${LAYERS_API_KEY}`,
      'Content-Type': 'application/json',
    },
    body: JSON.stringify({
      model: 'anthropic/claude-sonnet-4.5',
      messages: [
        { role: 'user', content: 'Solve: If x + 5 = 12, what is x?' }
      ],
      anthropic: {
        thinking: {
          type: 'enabled',
          budget_tokens: 3000,
        },
      },
      max_tokens: 500,
    }),
  });

  expect(response.status).toBe(200);
  const data = await response.json();

  // Check for thinking in metadata or response
  expect(data.choices[0].message.content).toContain('7');
});
```

## Request Format

```json
{
  "model": "anthropic/claude-sonnet-4.5",
  "messages": [
    {
      "role": "user",
      "content": "Solve this complex problem..."
    }
  ],
  "anthropic": {
    "thinking": {
      "type": "enabled",
      "budget_tokens": 5000
    }
  },
  "max_tokens": 1000
}
```

## Thinking Configuration

| Parameter | Type | Description |
|-----------|------|-------------|
| `type` | string | `"enabled"` or `"disabled"` |
| `budget_tokens` | number | Maximum tokens for thinking |

## Response with Thinking

```json
{
  "id": "chatcmpl-xxx",
  "model": "anthropic/claude-sonnet-4.5",
  "choices": [
    {
      "index": 0,
      "message": {
        "role": "assistant",
        "content": "The answer is 345."
      },
      "finish_reason": "stop"
    }
  ],
  "usage": {
    "prompt_tokens": 25,
    "completion_tokens": 150,
    "total_tokens": 175
  },
  "anthropic": {
    "thinking": "Let me work through this step by step..."
  }
}
```

## Supported Models

| Model | Extended Thinking |
|-------|-------------------|
| anthropic/claude-sonnet-4.5 | Yes |
| anthropic/claude-opus-4.5 | Yes |
| anthropic/claude-haiku-4.5 | Limited |
| openai/gpt-* | No |
| google/gemini-* | No |

## Use Cases

### Math Problems

```typescript
const response = await fetch('https://api.layers.dev/v1/chat', {
  method: 'POST',
  headers: {
    'Authorization': 'Bearer lyr_live_xxx',
    'Content-Type': 'application/json',
  },
  body: JSON.stringify({
    model: 'anthropic/claude-sonnet-4.5',
    messages: [
      {
        role: 'user',
        content: 'A train leaves at 9am traveling 60mph. Another leaves at 10am traveling 80mph. When do they meet?',
      },
    ],
    anthropic: {
      thinking: { type: 'enabled', budget_tokens: 8000 },
    },
    max_tokens: 1000,
  }),
});
```

### Code Analysis

```typescript
const response = await fetch('https://api.layers.dev/v1/chat', {
  method: 'POST',
  headers: {
    'Authorization': 'Bearer lyr_live_xxx',
    'Content-Type': 'application/json',
  },
  body: JSON.stringify({
    model: 'anthropic/claude-sonnet-4.5',
    messages: [
      {
        role: 'user',
        content: 'Review this code for bugs:\n```\nfunction sort(arr) { ... }\n```',
      },
    ],
    anthropic: {
      thinking: { type: 'enabled', budget_tokens: 10000 },
    },
    max_tokens: 2000,
  }),
});
```

### Logical Reasoning

```typescript
const response = await fetch('https://api.layers.dev/v1/chat', {
  method: 'POST',
  headers: {
    'Authorization': 'Bearer lyr_live_xxx',
    'Content-Type': 'application/json',
  },
  body: JSON.stringify({
    model: 'anthropic/claude-sonnet-4.5',
    messages: [
      {
        role: 'user',
        content: 'If all A are B, and some B are C, can we conclude that some A are C?',
      },
    ],
    anthropic: {
      thinking: { type: 'enabled', budget_tokens: 5000 },
    },
    max_tokens: 500,
  }),
});
```

## Best Practices

1. **Set appropriate budgets** - Higher for complex problems
2. **Use for reasoning tasks** - Math, logic, analysis
3. **Monitor token usage** - Thinking tokens are billable
4. **Adjust based on task** - Simple tasks don't need large budgets

## Budget Guidelines

| Task Complexity | Recommended Budget |
|-----------------|-------------------|
| Simple math | 1,000 - 2,000 |
| Medium reasoning | 3,000 - 5,000 |
| Complex analysis | 8,000 - 10,000 |
| Deep research | 15,000+ |
