---
title: Tools Tests (API)
description: 2 tests for function calling via the Layers API
---

# Tools Tests (API)

Tools tests verify that the Layers API correctly handles function calling (tools) in OpenAI-compatible format.

## Test Summary

| Test | Model | Description |
|------|-------|-------------|
| Claude Tools | claude-sonnet-4.5 | Weather function call |
| GPT-4o Tools | gpt-4o | Weather function call |

## Running Tests

```bash
cd packages/@layers/models
LAYERS_API_URL=https://web-nine-sage-13.vercel.app \
LAYERS_API_KEY=lyr_live_xxx \
bun test layers-api -t "Tools"
```

## Test Implementation

### Claude Tools Test

```typescript
it('should call tools with Claude via API', async () => {
  const response = await fetch(`${LAYERS_API_URL}/api/v1/chat`, {
    method: 'POST',
    headers: {
      'Authorization': `Bearer ${LAYERS_API_KEY}`,
      'Content-Type': 'application/json',
    },
    body: JSON.stringify({
      model: 'anthropic/claude-sonnet-4.5',
      messages: [
        { role: 'user', content: 'What is the weather in San Francisco?' }
      ],
      tools: [
        {
          type: 'function',
          function: {
            name: 'get_weather',
            description: 'Get the current weather in a location',
            parameters: {
              type: 'object',
              properties: {
                location: {
                  type: 'string',
                  description: 'The city and state',
                },
              },
              required: ['location'],
            },
          },
        },
      ],
      tool_choice: 'auto',
      max_tokens: 100,
    }),
  });

  expect(response.status).toBe(200);
  const data = await response.json();

  expect(data.choices[0].message.tool_calls).toBeDefined();
  expect(data.choices[0].message.tool_calls[0].function.name).toBe('get_weather');

  const args = JSON.parse(data.choices[0].message.tool_calls[0].function.arguments);
  expect(args.location).toContain('San Francisco');
});
```

## Request Format

```json
{
  "model": "anthropic/claude-sonnet-4.5",
  "messages": [
    { "role": "user", "content": "What is the weather in San Francisco?" }
  ],
  "tools": [
    {
      "type": "function",
      "function": {
        "name": "get_weather",
        "description": "Get the current weather in a location",
        "parameters": {
          "type": "object",
          "properties": {
            "location": {
              "type": "string",
              "description": "The city and state, e.g. San Francisco, CA"
            },
            "unit": {
              "type": "string",
              "enum": ["celsius", "fahrenheit"],
              "description": "Temperature unit"
            }
          },
          "required": ["location"]
        }
      }
    }
  ],
  "tool_choice": "auto"
}
```

## Response Format

```json
{
  "id": "chatcmpl-xxx",
  "object": "chat.completion",
  "model": "anthropic/claude-sonnet-4.5",
  "choices": [
    {
      "index": 0,
      "message": {
        "role": "assistant",
        "content": null,
        "tool_calls": [
          {
            "id": "call_abc123",
            "type": "function",
            "function": {
              "name": "get_weather",
              "arguments": "{\"location\":\"San Francisco, CA\"}"
            }
          }
        ]
      },
      "finish_reason": "tool_calls"
    }
  ]
}
```

## Tool Choice Options

| Option | Description |
|--------|-------------|
| `"auto"` | Model decides whether to call tools |
| `"none"` | Never call tools |
| `"required"` | Must call at least one tool |
| `{ "type": "function", "function": { "name": "get_weather" } }` | Force specific tool |

## Handling Tool Results

After receiving a tool call, send the result back:

```typescript
// 1. Initial request triggers tool call
const response1 = await fetch(`${LAYERS_API_URL}/api/v1/chat`, {
  // ... initial request with tools
});
const data1 = await response1.json();
const toolCall = data1.choices[0].message.tool_calls[0];

// 2. Execute the function (your code)
const weatherData = await getWeather(JSON.parse(toolCall.function.arguments));

// 3. Send result back
const response2 = await fetch(`${LAYERS_API_URL}/api/v1/chat`, {
  method: 'POST',
  headers: {
    'Authorization': `Bearer ${LAYERS_API_KEY}`,
    'Content-Type': 'application/json',
  },
  body: JSON.stringify({
    model: 'anthropic/claude-sonnet-4.5',
    messages: [
      { role: 'user', content: 'What is the weather in San Francisco?' },
      {
        role: 'assistant',
        content: null,
        tool_calls: [toolCall],
      },
      {
        role: 'tool',
        tool_call_id: toolCall.id,
        content: JSON.stringify(weatherData),
      },
    ],
    tools: [/* same tools */],
    max_tokens: 200,
  }),
});

// 4. Get final response
const data2 = await response2.json();
console.log(data2.choices[0].message.content);
// "The weather in San Francisco is 68Â°F and sunny."
```

## Supported Models

| Model | Tools Support |
|-------|---------------|
| anthropic/claude-* | Yes |
| openai/gpt-4o | Yes |
| openai/gpt-4o-mini | Yes |
| google/gemini-* | Yes |
| perplexity/sonar | No |
| morph/morph-* | No |

## Multiple Tools

```json
{
  "tools": [
    {
      "type": "function",
      "function": {
        "name": "get_weather",
        "description": "Get current weather",
        "parameters": { /* ... */ }
      }
    },
    {
      "type": "function",
      "function": {
        "name": "search_web",
        "description": "Search the web",
        "parameters": { /* ... */ }
      }
    }
  ]
}
```

## Best Practices

1. **Clear descriptions** - Help model understand when to use each tool
2. **Validate arguments** - Parse and validate tool call arguments
3. **Handle errors** - Tool execution may fail
4. **Limit tools** - Too many tools can confuse the model
